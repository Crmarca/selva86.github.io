<!DOCTYPE html>
<html>
  <head>
    <title>Time Series Analysis - r-statistics.co</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="/screenshots/iconb-64.png" type="image/x-icon" />
    <link href="www/bootstrap.min.css" rel="stylesheet">
    <link href="www/highlight.css" rel="stylesheet">

    <link href='http://fonts.googleapis.com/css?family=Inconsolata:400,700'
      rel='stylesheet' type='text/css'>
    <!-- Color Script -->
    <style type="text/css">
      a {
       color: #3675C5;
       color: rgb(25, 145, 248);
       color: #4582ec;
       color: #3F73D8;
      }
    </style>
  </head>

  <body>

    <div class="container">

      <div class="masthead">
       <!--
        <ul class="nav nav-pills pull-right">
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
              Table of contents<b class="caret"></b>
            </a>
            <ul class="dropdown-menu pull-right" role="menu">
              <li class="dropdown-header"></li>
<li class="dropdown-header">Tutorial</li>
<li><a href="R-Tutorial.html">R Tutorial</a></li>
<li class="dropdown-header">Foundations</li>
<li><a href="Linear-Regression.html">Linear Regression</a></li>
<li><a href="Assumptions-of-Linear-Regression.html">Assumptions of Linear Regression</a></li>
<li><a href="Statistical-Tests-in-R.html">Statistical Tests</a></li>
<li><a href="Variable-Selection-and-Importance-With-R.html">Feature Selection</a></li>
<li><a href="Model-Selection-in-R.html">Model Selection</a></li>
<li><a href="Logistic-Regression-With-R.html">Logistic Regression</a></li>
<li><a href="Environments.html">Advanced Linear Regression</a></li>

<li class="dropdown-header">Advanced Regression Models</li>
<li><a href="Robust-Regression-With-R.html">Robust Regression</a></li>
<li><a href="Probit-Regression-With-R.html">Probit Regression</a></li>
<li><a href="Multinomial-Regression-With-R.html">Multinomial Regression</a></li>
<li><a href="Ordinal-Logistic-Regression-With-R.html">Ordinal Logistic</a></li>
<li><a href="Poisson-And-Negative-Binomial-Regression-With-R.html">Poisson and Negative Binomial</a></li>
<li><a href="Ridge-Regression-With-R.html">Ridge Regression</a></li>
<li><a href="Lasso-Regression-With-R.html">Lasso Regression</a></li>
<li><a href="Beta-Regression-With-R.html">Beta Regression</a></li>
<li><a href="Dirichlet-Regression-With-R.html">Dirichlet Regression</a></li>
<li><a href="Loess-Regression-With-R.html">Loess Regression</a></li>
<li><a href="Isotonic-Regression-With-R.html">Isotonic Regression</a></li>

<li class="dropdown-header">Time Series</li>
<li><a href="Time-Series-Analysis-With-R.html">Time Series Analysis</a></li>
<li><a href="Time-Series-Forecasting-With-R.html">Time Series Forecasting </a></li>
<li><a href="Time-Series-Forecasting-With-R-part2.html">More Time Series Forecasting</a></li>

<li class="dropdown-header">High Performance Computing</li>
<li><a href="Parallel-Computing-With-R.html">Parallel computing</a></li>
<li><a href="Strategies-To-Improve-And-Speedup-R-Code.html">Strategies to Speedup R code</a></li>

<li class="dropdown-header">Useful Techniques</li>
<li><a href="Multi-Dimensional-Scaling-With-R.html">Multi Dimensional Scaling</a></li>
<li><a href="Profiling.html">Optimization</a></li>

            </ul>
          </li>
        </ul>
        -->

        <h3 class="muted"><a href="/">r-statistics.co</a> <small>by Selva Prabhakaran</small></h3>
        <hr>
      </div>

      <div class="row">
        <div class="col-xs-12 col-sm-3" id="nav">
        <div class="well">
          <li>
            <ul class="list-unstyled">
              <li class="dropdown-header"></li>
<li class="dropdown-header">Tutorial</li>
<li><a href="R-Tutorial.html">R Tutorial</a></li>
<li class="dropdown-header">Foundations</li>
<li><a href="Linear-Regression.html">Linear Regression</a></li>
<li><a href="Assumptions-of-Linear-Regression.html">Assumptions of Linear Regression</a></li>
<li><a href="Statistical-Tests-in-R.html">Statistical Tests</a></li>
<li><a href="Variable-Selection-and-Importance-With-R.html">Feature Selection</a></li>
<li><a href="Model-Selection-in-R.html">Model Selection</a></li>
<li><a href="Logistic-Regression-With-R.html">Logistic Regression</a></li>
<li><a href="Environments.html">Advanced Linear Regression</a></li>

<li class="dropdown-header">Advanced Regression Models</li>
<li><a href="Robust-Regression-With-R.html">Robust Regression</a></li>
<li><a href="Probit-Regression-With-R.html">Probit Regression</a></li>
<li><a href="Multinomial-Regression-With-R.html">Multinomial Regression</a></li>
<li><a href="Ordinal-Logistic-Regression-With-R.html">Ordinal Logistic</a></li>
<li><a href="Poisson-And-Negative-Binomial-Regression-With-R.html">Poisson and Negative Binomial</a></li>
<li><a href="Ridge-Regression-With-R.html">Ridge Regression</a></li>
<li><a href="Lasso-Regression-With-R.html">Lasso Regression</a></li>
<li><a href="Beta-Regression-With-R.html">Beta Regression</a></li>
<li><a href="Dirichlet-Regression-With-R.html">Dirichlet Regression</a></li>
<li><a href="Loess-Regression-With-R.html">Loess Regression</a></li>
<li><a href="Isotonic-Regression-With-R.html">Isotonic Regression</a></li>

<li class="dropdown-header">Time Series</li>
<li><a href="Time-Series-Analysis-With-R.html">Time Series Analysis</a></li>
<li><a href="Time-Series-Forecasting-With-R.html">Time Series Forecasting </a></li>
<li><a href="Time-Series-Forecasting-With-R-part2.html">More Time Series Forecasting</a></li>

<li class="dropdown-header">High Performance Computing</li>
<li><a href="Parallel-Computing-With-R.html">Parallel computing</a></li>
<li><a href="Strategies-To-Improve-And-Speedup-R-Code.html">Strategies to Speedup R code</a></li>

<li class="dropdown-header">Useful Techniques</li>
<li><a href="Multi-Dimensional-Scaling-With-R.html">Multi Dimensional Scaling</a></li>
<li><a href="Profiling.html">Optimization</a></li>

            </ul>
          </li>
        </div>

        <div class="well">
          Want to get involved? <a href="mailto:rcodeprogramming@gmail.com">Let me know!</a>.
        </div>

        
        <h4>Contents</h4>
        
          <ul class="list-unstyled" id="toc"></ul>
        <!--
          <hr>
          <p><a href="/contribute.html">How to contribute</a></p>

          <p><a class="btn btn-primary" href="">Edit this page</a></p>
        -->  
        </div>

        <div id="content" class="col-xs-12 col-sm-8 pull-right">

          <blockquote>
<p>Any metric that is measured over regular time intervals forms a time series. Analysis of time series is commercially importance because of industrial need and relevance especially w.r.t forecasting (demand, sales, supply etc).</p>
</blockquote>
<p>A time series can be broken down to its components so as to systematically understand, analyze, model and forecast it. This is a beginners introduction to time series analysis, answering fundamental questions such as:</p>
<ol style="list-style-type: decimal">
<li>What are the components of a time series</li>
<li>What is a stationary time series</li>
<li>How to decompose it</li>
<li>How to de-trend, de-seasonalize a time series</li>
<li>What is auto correlation etc.</li>
</ol>
<h2>What is a Time Series ?</h2>
<p>Any metric that is measured over regular time intervals makes a Time Series. Example: Weather data, Stock prices, Industry forecasts, etc are some of the common ones.</p>
<h2>How To Create A Time Series In R ?</h2>
<p>Upon importing your data into R, use ts() function as follows. The inputData used here is ideally a numeric vector of the class ‘numeric’ or ‘integer’.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ts</span> (inputData, <span class="dt">frequency =</span> <span class="dv">4</span>, <span class="dt">start =</span> <span class="kw">c</span>(<span class="dv">1959</span>, <span class="dv">2</span>)) <span class="co"># frequency 4 =&gt; Quarterly Data</span>
<span class="kw">ts</span> (<span class="dv">1</span>:<span class="dv">10</span>, <span class="dt">frequency =</span> <span class="dv">12</span>, <span class="dt">start =</span> <span class="dv">1990</span>) <span class="co"># freq 12 =&gt; Monthly data. The start and end params are optional.</span>
<span class="kw">ts</span> (inputData, <span class="dt">start=</span><span class="kw">c</span>(<span class="dv">2009</span>), <span class="dt">end=</span><span class="kw">c</span>(<span class="dv">2014</span>), <span class="dt">frequency=</span><span class="dv">1</span>) <span class="co"># Yearly Data</span></code></pre></div>
<h2>Understanding Your Time Series</h2>
<p>Each data point <span class="math inline">(<em>Y</em><em>t</em>)</span> at time <span class="math inline"><em>t</em></span> in a Time Series can be expressed as either a sum or a product of 3 components, namely, <em>Seasonality(St)</em>, <em>Trend(Tt)</em> and <em>Error(et)</em> (a.k.a White Noise).</p>
<h5>For Additive Time Series,</h5>
<pre><code>           $$Yt = St + Tt + et$$</code></pre>
<h5>For Multiplicative Time Series,</h5>
<pre><code>           $$Yt = St * Tt * et$$</code></pre>
<p>A multiplicative time series can be converted to additive by taking a log of the time series.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">additiveTS &lt;-<span class="st"> </span><span class="kw">log</span> (multiplcativeTS)  <span class="co"># convert multiplicative to additive time series</span></code></pre></div>
<h2>What Is A Stationary Time Series ?</h2>
<p>A time series is said to be stationary if it holds the following conditions true.</p>
<ol style="list-style-type: decimal">
<li>The mean value of time-series is constant over time, which implies, the trend component is nullified.</li>
<li>The variance does not increase over time.</li>
<li>Seasonality effect is minimal.</li>
</ol>
<h2>How to extract the trend, seasonality and error?</h2>
<p>The <code>decompose()</code> and <code>stl()</code> splits the time series into seasonality, trend and error components.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tsData &lt;-<span class="st"> </span>EuStockMarkets[, <span class="dv">1</span>] <span class="co"># ts data</span>
decomposedRes &lt;-<span class="st"> </span><span class="kw">decompose</span>(tsData, <span class="dt">type=</span><span class="st">&quot;mult&quot;</span>) <span class="co"># use type = &quot;additive&quot; for additive components</span>
<span class="kw">plot</span> (decomposedRes) <span class="co"># see plot below</span>
stlRes &lt;-<span class="st"> </span><span class="kw">stl</span>(tsData, <span class="dt">s.window =</span> <span class="st">&quot;periodic&quot;</span>)

<span class="co"># Few rows of stlRes</span>
$time.series
Time Series:
Start =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1991</span>, <span class="dv">130</span>) 
End =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1998</span>, <span class="dv">169</span>) 
Frequency =<span class="st"> </span><span class="dv">260</span> 
             seasonal    trend    remainder
<span class="fl">1991.496</span>   <span class="fl">43.1900952</span> <span class="fl">1602.604</span>  -<span class="fl">17.0445950</span>
<span class="fl">1991.500</span>   <span class="fl">55.3795008</span> <span class="fl">1603.064</span>  -<span class="fl">44.8134914</span>
<span class="fl">1991.504</span>   <span class="fl">61.2914064</span> <span class="fl">1603.523</span>  -<span class="fl">58.3048878</span>
<span class="fl">1991.508</span>   <span class="fl">68.4470620</span> <span class="fl">1603.983</span>  -<span class="fl">51.3900342</span>
<span class="fl">1991.512</span>   <span class="fl">68.4527176</span> <span class="fl">1604.442</span>  -<span class="fl">54.7351806</span>
<span class="fl">1991.515</span>   <span class="fl">70.8396232</span> <span class="fl">1604.902</span>  -<span class="fl">65.1315770</span></code></pre></div>
<h2>How to create lags of a time-series ?</h2>
<p>When the time base is shifted by a given number of periods, a Lag of time series is created. Lags of a time series are often used as explanatory variables to model the actual time series itself. The underlying reasoning is that the state of the time series few periods back may still has an influence on the serie’s current state.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">laggedTS &lt;-<span class="st"> </span><span class="kw">lag</span>(tsData, <span class="dv">3</span>) <span class="co"># shifted 3 periods earlier. Use “-3″ to shift by 3 periods forward (later).</span></code></pre></div>
<h2>What Is Autocorrelation and Partial-Autocorrelation?</h2>
<p><strong>Autocorrelation</strong> is the correlation of a Time Series with lags of itself. This is a significant metric because, it is used commonly to determine if the time series is stationary or not. A stationary time series will have the autocorrelation fall to zero fairly quickly but for a non-stationary series it drops gradually.</p>
<p><strong>Partial Autocorrelation</strong> is the correlation of the timeseries with a lag of itself, with the linear dependence of all the lags between them removed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">acfRes &lt;-<span class="st"> </span><span class="kw">acf</span>(TS) <span class="co"># both acf() and pacf() generates plots</span>
pacfRes &lt;-<span class="st"> </span><span class="kw">pacf</span>(TS)
ccfRes &lt;-<span class="st"> </span><span class="kw">ccf</span>(TS1, TS2) <span class="co"># computes cross correlation between 2 timeseries.</span></code></pre></div>
<h2>How To De-Trend a Time Series ?</h2>
<p>Use linear regression to model the Time Series data with indices. The model residuals will usually be devoid of the trend component. If some trend is left over to be seen in the residuals (like what it seems to be with ‘JohnsonJohnson’ data below), then you might wish to add few predictors to the lm() call (like a seasonal dummy, fourier transform or may be a lag of the series itself), until the trend is filtered.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trModel &lt;-<span class="st"> </span><span class="kw">lm</span>(TS ~<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>:<span class="kw">length</span>(TS)))
<span class="kw">plot</span>(<span class="kw">resid</span>(trModel), <span class="dt">type=</span><span class="st">&quot;l&quot;</span>)  <span class="co"># resid(trModel) contains the de-trended series.</span></code></pre></div>
<h2>How To De-Seasonalize a Time Series in R?</h2>
<p>De-seasonalizing throws insight about the effects seasonal pattern in the time series and helps to model the data without the seasonal effects, which can later be customized. Step 1: De-compose the Time series using stl() Step 2: use seasadj() from ‘forecast’ package</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(forecast)
ts.stl &lt;-<span class="st"> </span><span class="kw">stl</span>(TS,<span class="st">&quot;periodic&quot;</span>)  <span class="co"># decompose the TS</span>
ts.sa &lt;-<span class="st"> </span><span class="kw">seasadj</span>(ts.stl)  <span class="co"># de-seasonalize</span>
<span class="kw">seasonplot</span>(ts.sa,<span class="dv">12</span>, <span class="dt">col=</span><span class="kw">rainbow</span>(<span class="dv">12</span>),<span class="dt">year.labels=</span><span class="ot">TRUE</span>) <span class="co"># seasonal frequency set as 12 for monthly data.</span></code></pre></div>
<h2>How To Difference A Time Series ?</h2>
<p><em>Differencing</em> a time series means, to subtract each data point in the series from its successor. It is commonly used to make a Time Series Stationary. For most time series patterns, 1 or 2 differencing is necessary to make it a stationary series.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">differencedTS &lt;-<span class="st"> </span><span class="kw">diff</span>(ts)
differencedTwice &lt;-<span class="st"> </span><span class="kw">diff</span>(ts, <span class="dt">differences=</span> <span class="dv">2</span>) <span class="co"># differenced twice</span></code></pre></div>
<h2>How to test if a time series is stationary?</h2>
<p>Use Augmented Dickey-Fuller Test (adf test). A p-Value of less than 0.05 in adf.test() indicates that it is stationary.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tseries)
<span class="kw">adf.test</span>(tsData) <span class="co"># p-value &lt; 0.05 indicates the TS is stationary</span></code></pre></div>


        </div>
      </div>

      <div class="footer">
        <hr>
        <p>&copy; r-statistics.co. Powered by <a href="http://jekyllrb.com/">jekyll</a>,
          <a href="http://yihui.name/knitr/">knitr</a>, and
          <a href="http://johnmacfarlane.net/pandoc/">pandoc</a>. Source
          available on <a href="https://github.com/selva86/selva86.github.io/">github</a>.
          This work is licensed under the <a href="http://creativecommons.org/licenses/by-nc/3.0/">CC BY-NC 3.0 Creative Commons License.</a>
        </p>
      </div>

    </div> <!-- /container -->

  <script src="//code.jquery.com/jquery.js"></script>
  <script src="www/bootstrap.min.js"></script>
  <script src="www/toc.js"></script>
  <!-- MathJax Script -->
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
    });
  </script>
  <script type="text/javascript"
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  </body>
</html>