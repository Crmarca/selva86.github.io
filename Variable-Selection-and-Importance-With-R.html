<!DOCTYPE html>
<html>
  <head>
    <title>Feature Selection &middot; r-statistics.co</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="www/bootstrap.min.css" rel="stylesheet">
    <link href="www/highlight.css" rel="stylesheet">

    <link href='http://fonts.googleapis.com/css?family=Inconsolata:400,700'
      rel='stylesheet' type='text/css'>
  </head>

  <body>

    <div class="container">

      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
              Table of contents<b class="caret"></b>
            </a>
            <ul class="dropdown-menu pull-right" role="menu">
              <li><a href="R-Tutorial.html">R Tutorial</a></li>
<li class="dropdown-header">Foundations</li>
<li><a href="Linear-Regression.html">Linear Regression</a></li>
<li><a href="Assumptions-of-Linear-Regression.html">Assumptions of Linear Regression</a></li>
<li><a href="Statistical-Tests-in-R.html">Statistical Tests</a></li>
<li><a href="Variable-Selection-and-Importance-With-R.html">Feature Selection</a></li>
<li><a href="Model-Selection-in-R.html">Model Selection</a></li>
<li><a href="OO-essentials.html">Logistic Regression</a></li>
<li><a href="Environments.html">Advanced Linear Regression</a></li>

<li class="dropdown-header">Advanced Regression Models</li>
<li><a href="Functional-programming.html">Robust Regression</a></li>
<li><a href="Functionals.html">Probit Regression</a></li>
<li><a href="Function-operators.html">Multinomial Regression</a></li>
<li><a href="Functional-programming.html">Ordinal Logistic</a></li>
<li><a href="Functionals.html">Poisson and Negative Binomial</a></li>
<li><a href="Function-operators.html">Ridge Regression</a></li>
<li><a href="Function-operators.html">Beta Regression</a></li>
<li><a href="Function-operators.html">Dirichlet Regression</a></li>
<li><a href="Function-operators.html">Loess Regression</a></li>
<li><a href="Function-operators.html">Isotonic Regression</a></li>

<li class="dropdown-header">Time Series</li>
<li><a href="Computing-on-the-language.html">Time Series Analysis</a></li>
<li><a href="Expressions.html">Time Series Forecasting </a></li>
<li><a href="dsl.html">More Timeseries Forecasting</a></li>

<li class="dropdown-header">High Performance Computing</li>
<li><a href="Performance.html">Parallel computing</a></li>
<li><a href="Profiling.html">Strategies to Speedup R code</a></li>

            </ul>
          </li>
        </ul>

        <h3 class="muted"><a href="/">r-statistics.co</a> <small>by Selva Prabhakaran</small></h3>
        <hr>
      </div>

      <div class="row">
        <div class="col-xs-12 col-sm-3" id="nav">
        <div class="well">
          <li>
            <ul class="list-unstyled">
              <li><a href="R-Tutorial.html">R Tutorial</a></li>
<li class="dropdown-header">Foundations</li>
<li><a href="Linear-Regression.html">Linear Regression</a></li>
<li><a href="Assumptions-of-Linear-Regression.html">Assumptions of Linear Regression</a></li>
<li><a href="Statistical-Tests-in-R.html">Statistical Tests</a></li>
<li><a href="Variable-Selection-and-Importance-With-R.html">Feature Selection</a></li>
<li><a href="Model-Selection-in-R.html">Model Selection</a></li>
<li><a href="OO-essentials.html">Logistic Regression</a></li>
<li><a href="Environments.html">Advanced Linear Regression</a></li>

<li class="dropdown-header">Advanced Regression Models</li>
<li><a href="Functional-programming.html">Robust Regression</a></li>
<li><a href="Functionals.html">Probit Regression</a></li>
<li><a href="Function-operators.html">Multinomial Regression</a></li>
<li><a href="Functional-programming.html">Ordinal Logistic</a></li>
<li><a href="Functionals.html">Poisson and Negative Binomial</a></li>
<li><a href="Function-operators.html">Ridge Regression</a></li>
<li><a href="Function-operators.html">Beta Regression</a></li>
<li><a href="Function-operators.html">Dirichlet Regression</a></li>
<li><a href="Function-operators.html">Loess Regression</a></li>
<li><a href="Function-operators.html">Isotonic Regression</a></li>

<li class="dropdown-header">Time Series</li>
<li><a href="Computing-on-the-language.html">Time Series Analysis</a></li>
<li><a href="Expressions.html">Time Series Forecasting </a></li>
<li><a href="dsl.html">More Timeseries Forecasting</a></li>

<li class="dropdown-header">High Performance Computing</li>
<li><a href="Performance.html">Parallel computing</a></li>
<li><a href="Profiling.html">Strategies to Speedup R code</a></li>

            </ul>
          </li>
        </div>

        <div class="well">
          Want to get involved? <a href="">Let me know!</a>.
        </div>

        <h4>Contents</h4>
          <ul class="list-unstyled" id="toc"></ul>

          <hr>
          <p><a href="/contribute.html">How to contribute</a></p>

          <p><a class="btn btn-primary" href="">Edit this page</a></p>
        </div>

        <div id="content" class="col-xs-12 col-sm-8 pull-right">

          <blockquote>
<p>Finding the most important predictor variables (of features) that explains major part of variance of the response variable is key to identify and build high performing models.</p>
</blockquote>
<h2>Import Data</h2>
<p>For illustrating the various methods, we will use the ‘Ozone’ data from ‘mlbench’ package, except for Information value method which is applicable for binary categorical response variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">inputData &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://rstatistics.net/wp-content/uploads/2015/09/ozone1.csv&quot;</span>, <span class="dt">stringsAsFactors=</span>F)</code></pre></div>
<h2>1. Random Forest Method</h2>
<p>Random forest can be very effective to find a set of predictors that best explains the variance in the response variable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(party)
cf1 &lt;-<span class="st"> </span><span class="kw">cforest</span>(ozone_reading ~<span class="st"> </span>. , <span class="dt">data=</span> inputData, <span class="dt">control=</span><span class="kw">cforest_unbiased</span>(<span class="dt">mtry=</span><span class="dv">2</span>,<span class="dt">ntree=</span><span class="dv">50</span>)) <span class="co"># fit the random forest</span>
<span class="kw">varimp</span>(cf1) <span class="co"># get variable importance, based on mean decrease in accuracy</span>
<span class="co">#=&gt;                 Month          Day_of_month           Day_of_week </span>
<span class="co">#=&gt;           0.689167598           0.115937291          -0.004641633 </span>
<span class="co">#=&gt;       pressure_height            Wind_speed              Humidity </span>
<span class="co">#=&gt;           5.519633507           0.125868789           3.474611356 </span>
<span class="co">#=&gt;  Temperature_Sandburg   Temperature_ElMonte Inversion_base_height </span>
<span class="co">#=&gt;          12.878794481          14.175901506           4.276103121 </span>
<span class="co">#=&gt;     Pressure_gradient Inversion_temperature            Visibility </span>
<span class="co">#=&gt;           3.234732558          11.738969777           2.283430842</span>
<span class="kw">varimp</span>(cf1, <span class="dt">conditional=</span><span class="ot">TRUE</span>)  <span class="co"># conditional=True, adjusts for correlations between predictors</span>
<span class="co">#=&gt;                 Month          Day_of_month           Day_of_week </span>
<span class="co">#=&gt;            0.08899435            0.19311805            0.02526252 </span>
<span class="co">#=&gt;       pressure_height            Wind_speed              Humidity </span>
<span class="co">#=&gt;            0.35458493           -0.19089686            0.14617239 </span>
<span class="co">#=&gt;  Temperature_Sandburg   Temperature_ElMonte Inversion_base_height </span>
<span class="co">#=&gt;            0.74640367            1.19786882            0.69662788 </span>
<span class="co">#=&gt;     Pressure_gradient Inversion_temperature            Visibility </span>
<span class="co">#=&gt;            0.58295887            0.65507322            0.05380003</span>
<span class="kw">varimpAUC</span>(cf1)  <span class="co"># more robust towards class imbalance.</span>
<span class="co">#=&gt;                 Month          Day_of_month           Day_of_week </span>
<span class="co">#=&gt;            1.12821259           -0.04079495            0.07800158 </span>
<span class="co">#=&gt;       pressure_height            Wind_speed              Humidity </span>
<span class="co">#=&gt;            5.85160593            0.11250973            3.32289714 </span>
<span class="co">#=&gt;  Temperature_Sandburg   Temperature_ElMonte Inversion_base_height </span>
<span class="co">#=&gt;           11.97425093           13.66085973            3.70572939 </span>
<span class="co">#=&gt;     Pressure_gradient Inversion_temperature            Visibility </span>
<span class="co">#=&gt;            3.05169171           11.48762432            2.04145930</span></code></pre></div>
<h2>2. Relative Importance</h2>
<p>Using calc.relimp {relaimpo}, the relative importance of variables fed into a lm model can be determined as a relative percentage.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(relaimpo)
lmMod &lt;-<span class="st"> </span><span class="kw">lm</span>(ozone_reading ~<span class="st"> </span>. , <span class="dt">data =</span> inputData)  <span class="co"># fit lm() model</span>
relImportance &lt;-<span class="st"> </span><span class="kw">calc.relimp</span>(lmMod, <span class="dt">type =</span> <span class="st">&quot;lmg&quot;</span>, <span class="dt">rela =</span> <span class="ot">TRUE</span>)  <span class="co"># calculate relative importance scaled to 100</span>
<span class="kw">sort</span>(relImportance$lmg, <span class="dt">decreasing=</span><span class="ot">TRUE</span>)  <span class="co"># relative importance</span>
<span class="co">#=&gt;   Temperature_ElMonte  Temperature_Sandburg Inversion_temperature </span>
<span class="co">#=&gt;          0.2297491560          0.2095385438          0.1692950876 </span>
<span class="co">#=&gt;       pressure_height Inversion_base_height              Humidity </span>
<span class="co">#=&gt;          0.1104276154          0.1000912612          0.0833080699 </span>
<span class="co">#=&gt;            Visibility     Pressure_gradient                 Month </span>
<span class="co">#=&gt;          0.0433277042          0.0320457048          0.0164342902 </span>
<span class="co">#=&gt;            Wind_speed          Day_of_month           Day_of_week </span>
<span class="co">#=&gt;          0.0034984964          0.0016927799          0.0005912906</span></code></pre></div>
<h2>4. MARS</h2>
<p>The earth package implements variable importance based on Generalized cross validation (GCV), number of subset models the variable occurs (nsubsets) and residual sum of squares (RSS).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(earth)
marsModel &lt;-<span class="st"> </span><span class="kw">earth</span>(ozone_reading ~<span class="st"> </span>., <span class="dt">data=</span>inputData) <span class="co"># build model</span>
ev &lt;-<span class="st"> </span><span class="kw">evimp</span> (marsModel) <span class="co"># estimate variable importance</span>
<span class="co">#=&gt;                       nsubsets   gcv    rss</span>
<span class="co">#=&gt; Temperature_ElMonte         29 100.0  100.0</span>
<span class="co">#=&gt; Pressure_gradient           28  42.5   48.4</span>
<span class="co">#=&gt; pressure_height             26  30.1   38.1</span>
<span class="co">#=&gt; Month9                      25  26.1   34.8</span>
<span class="co">#=&gt; Month5                      24  21.9   31.7</span>
<span class="co">#=&gt; Month4                      23  19.9   30.0</span>
<span class="co">#=&gt; Month3                      22  17.6   28.3</span>
<span class="co">#=&gt; Inversion_base_height       21  14.4   26.1</span>
<span class="co">#=&gt; Month11                     19  12.3   24.1</span>
<span class="co">#=&gt; Visibility                  18  11.4   23.2</span>
<span class="co">#=&gt; Day_of_month23              14   8.9   19.8</span>
<span class="co">#=&gt; Humidity                    13   7.4   18.7</span>
<span class="co">#=&gt; Month6                      11   5.1   16.6</span>
<span class="co">#=&gt; Temperature_Sandburg         9   7.0   15.6</span>
<span class="co">#=&gt; Wind_speed                   7   5.1   13.4</span>
<span class="co">#=&gt; Month12                      6   4.2   12.3</span>
<span class="co">#=&gt; Day_of_month9                3   4.6    9.1</span>
<span class="co">#=&gt; Day_of_week4                 2  -3.9    5.9</span>
<span class="co">#=&gt; Day_of_month7-unused         1  -4.7    2.8</span>

<span class="kw">plot</span> (ev)</code></pre></div>
<p><img src='screenshots/variable-importance-mars.png' width=528 height=349 /></p>
<h2>5. Step-wise Regression</h2>
<p>If you have large number of predictors (&gt; 15), split the inputData in chunks of 10 predictors with each chunk holding the <code>responseVar</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">base.mod &lt;-<span class="st"> </span><span class="kw">lm</span>(ozone_reading ~<span class="st"> </span><span class="dv">1</span> , <span class="dt">data=</span> inputData)  <span class="co"># base intercept only model</span>
all.mod &lt;-<span class="st"> </span><span class="kw">lm</span>(ozone_reading ~<span class="st"> </span>. , <span class="dt">data=</span> inputData) <span class="co"># full model with all predictors</span>
stepMod &lt;-<span class="st"> </span><span class="kw">step</span>(base.mod, <span class="dt">scope =</span> <span class="kw">list</span>(<span class="dt">lower =</span> base.mod, <span class="dt">upper =</span> all.mod), <span class="dt">direction =</span> <span class="st">&quot;both&quot;</span>, <span class="dt">trace =</span> <span class="dv">0</span>, <span class="dt">steps =</span> <span class="dv">1000</span>)  <span class="co"># perform step-wise algorithm</span>
shortlistedVars &lt;-<span class="st"> </span><span class="kw">names</span>(<span class="kw">unlist</span>(stepMod[[<span class="dv">1</span>]])) <span class="co"># get the shortlisted variable.</span>
shortlistedVars &lt;-<span class="st"> </span>shortlistedVars[!shortlistedVars %in%<span class="st"> &quot;(Intercept)&quot;</span>]  <span class="co"># remove intercept </span>
<span class="kw">print</span>(shortlistedVars)
<span class="co">#=&gt; [1] &quot;Temperature_Sandburg&quot;  &quot;Humidity&quot;              &quot;Temperature_ElMonte&quot;  </span>
<span class="co">#=&gt; [4] &quot;Month&quot;                 &quot;pressure_height&quot;       &quot;Inversion_base_height&quot;</span></code></pre></div>
<p>The output could includes levels within categorical variables, since ‘stepwise’ is a linear regression based technique, as seen above.</p>
<p>If you have a large number of predictor variables (100+), the above code may need to be placed in a loop that will run stepwise on sequential chunks of predictors. The shortlisted variables can be accumulated for further analysis towards the end of each iteration. This can be very effective method, if you want to (i) be highly selective about discarding valuable predictor variables. (ii) build multiple models on the response variable.</p>
<h2>6. Boruta</h2>
<p>The ‘Boruta’ method can be used to decide if a variable is important or not.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(Boruta)
<span class="co"># Decide if a variable is important or not using Boruta</span>
boruta_output &lt;-<span class="st"> </span><span class="kw">Boruta</span>(ozone_reading ~<span class="st"> </span>., <span class="dt">data=</span><span class="kw">na.omit</span>(inputData), <span class="dt">doTrace=</span><span class="dv">2</span>)  <span class="co"># perform Boruta search</span>
<span class="co"># Confirmed 10 attributes: Humidity, Inversion_base_height, Inversion_temperature, Month, Pressure_gradient and 5 more.</span>
<span class="co"># Rejected 3 attributes: Day_of_month, Day_of_week, Wind_speed.</span>
boruta_signif &lt;-<span class="st"> </span><span class="kw">names</span>(boruta_output$finalDecision[boruta_output$finalDecision %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Confirmed&quot;</span>, <span class="st">&quot;Tentative&quot;</span>)])  <span class="co"># collect Confirmed and Tentative variables</span>
<span class="kw">print</span>(boruta_signif)  <span class="co"># significant variables</span>
<span class="co">#=&gt; [1] &quot;Month&quot;                 &quot;ozone_reading&quot;         &quot;pressure_height&quot;      </span>
<span class="co">#=&gt; [4] &quot;Humidity&quot;              &quot;Temperature_Sandburg&quot;  &quot;Temperature_ElMonte&quot;  </span>
<span class="co">#=&gt; [7] &quot;Inversion_base_height&quot; &quot;Pressure_gradient&quot;     &quot;Inversion_temperature&quot;</span>
<span class="co">#=&gt; [10] &quot;Visibility&quot;</span>
<span class="kw">plot</span>(boruta_output, <span class="dt">cex.axis=</span>.<span class="dv">7</span>, <span class="dt">las=</span><span class="dv">2</span>, <span class="dt">xlab=</span><span class="st">&quot;&quot;</span>, <span class="dt">main=</span><span class="st">&quot;Variable Importance&quot;</span>)  <span class="co"># plot variable importance</span></code></pre></div>
<p><img src='screenshots/boruta-variable-importance.png' width=528 height=305 /></p>
<h2>7. Information value and Weight of evidence</h2>
<h4>Install package from github</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(devtools)
<span class="kw">install_github</span>(<span class="st">&quot;riv&quot;</span>,<span class="st">&quot;tomasgreif&quot;</span>)
<span class="kw">install_github</span>(<span class="st">&quot;woe&quot;</span>,<span class="st">&quot;tomasgreif&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(woe)
<span class="kw">library</span>(riv)
iv_df &lt;-<span class="st"> </span><span class="kw">iv.mult</span>(german_data, <span class="dt">y=</span><span class="st">&quot;gb&quot;</span>, <span class="dt">summary=</span>T)
iv &lt;-<span class="st"> </span><span class="kw">iv.mult</span>(german_data, <span class="dt">y=</span><span class="st">&quot;gb&quot;</span>)
<span class="kw">print</span>(iv_df)
<span class="kw">print</span>(iv_df)
<span class="co">#=&gt;                     Variable InformationValue Bins ZeroBins    Strength</span>
<span class="co">#=&gt; 1                  ca_status      0.666011503    4        0 Very strong</span>
<span class="co">#=&gt; 2             credit_history      0.293233547    5        0      Strong</span>
<span class="co">#=&gt; 3                   duration      0.259146834    5        0      Strong</span>
<span class="co">#=&gt; 4              credit_amount      0.207970035    5        0      Strong</span>
<span class="co">#=&gt; 5                    savings      0.196009557    5        0     Average</span>
<span class="co">#=&gt; 6                    purpose      0.169195066   10        0     Average</span>
<span class="co">#=&gt; 7                        age      0.125210683    5        0     Average</span>
<span class="co">#=&gt; 8                   property      0.112638262    4        0     Average</span>
<span class="co">#=&gt; 9   present_employment_since      0.086433631    5        0        Weak</span>
<span class="co">#=&gt; 10                   housing      0.083293434    3        0        Weak</span>
<span class="co">#=&gt; 11         other_installment      0.057614542    3        0        Weak</span>
<span class="co">#=&gt; 12                status_sex      0.044670678    5        1        Weak</span>
<span class="co">#=&gt; 13            foreign_worker      0.043877412    2        0        Weak</span>
<span class="co">#=&gt; 14             other_debtors      0.032019322    3        0        Weak</span>
<span class="co">#=&gt; 15   installment_rate_income      0.023858552    2        0        Weak</span>
<span class="co">#=&gt; 16          existing_credits      0.010083557    2        0   Wery weak</span>
<span class="co">#=&gt; 17                       job      0.008762766    4        0   Wery weak</span>
<span class="co">#=&gt; 18                 telephone      0.006377605    2        0   Wery weak</span>
<span class="co">#=&gt; 19 liable_maintenance_people      0.000000000    1        0   Wery weak</span>
<span class="co">#=&gt; 20   present_residence_since      0.000000000    1        0   Wery weak</span></code></pre></div>
<h3>Plot the information value summary</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Plot information value summary</span>
<span class="kw">iv.plot.summary</span>(iv_df)</code></pre></div>
<p><img src='screenshots/information-value-plot.png' width=528 height=327 /></p>
<h3>Calculate weight of evidence variables</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># add woe variables to original data frame.</span>
german_data_iv &lt;-<span class="st"> </span><span class="kw">iv.replace.woe</span>(german_data, iv, <span class="dt">verbose=</span><span class="ot">TRUE</span>)  
<span class="co"># results not shown because of large data size</span></code></pre></div>
<p>The newly created woe variables can alternatively be in place of the original factor variables.</p>


        </div>
      </div>

      <div class="footer">
        <hr>
        <p>&copy; r-statistics.co. Powered by <a href="http://jekyllrb.com/">jekyll</a>,
          <a href="http://yihui.name/knitr/">knitr</a>, and
          <a href="http://johnmacfarlane.net/pandoc/">pandoc</a>. Source
          available on <a href="https://github.com/selva86/selva86.github.io/">github</a>.
        </p>
      </div>

    </div> <!-- /container -->

  <script src="//code.jquery.com/jquery.js"></script>
  <script src="www/bootstrap.min.js"></script>
  <script src="www/toc.js"></script>
  </body>
</html>