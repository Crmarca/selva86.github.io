<!DOCTYPE html>
<html>
  <head>
    <title>Time Series Forecasting - r-statistics.co</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="/screenshots/iconb-64.png" type="image/x-icon" />
    <link href="www/bootstrap.min.css" rel="stylesheet">
    <link href="www/highlight.css" rel="stylesheet">

    <link href='http://fonts.googleapis.com/css?family=Inconsolata:400,700'
      rel='stylesheet' type='text/css'>
    <!-- Color Script -->
    <style type="text/css">
      a {
       color: #3675C5;
       color: rgb(25, 145, 248);
       color: #4582ec;
       color: #3F73D8;
      }
    </style>
  </head>

  <body>

    <div class="container">

      <div class="masthead">
       <!--
        <ul class="nav nav-pills pull-right">
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
              Table of contents<b class="caret"></b>
            </a>
            <ul class="dropdown-menu pull-right" role="menu">
              <li class="dropdown-header"></li>
<li class="dropdown-header">Tutorial</li>
<li><a href="R-Tutorial.html">R Tutorial</a></li>
<li class="dropdown-header">Foundations</li>
<li><a href="Linear-Regression.html">Linear Regression</a></li>
<li><a href="Assumptions-of-Linear-Regression.html">Assumptions of Linear Regression</a></li>
<li><a href="Statistical-Tests-in-R.html">Statistical Tests</a></li>
<li><a href="Variable-Selection-and-Importance-With-R.html">Feature Selection</a></li>
<li><a href="Model-Selection-in-R.html">Model Selection</a></li>
<li><a href="Logistic-Regression-With-R.html">Logistic Regression</a></li>
<li><a href="Environments.html">Advanced Linear Regression</a></li>

<li class="dropdown-header">Advanced Regression Models</li>
<li><a href="Robust-Regression-With-R.html">Robust Regression</a></li>
<li><a href="Probit-Regression-With-R.html">Probit Regression</a></li>
<li><a href="Multinomial-Regression-With-R.html">Multinomial Regression</a></li>
<li><a href="Ordinal-Logistic-Regression-With-R.html">Ordinal Logistic</a></li>
<li><a href="Poisson-And-Negative-Binomial-Regression-With-R.html">Poisson and Negative Binomial</a></li>
<li><a href="Ridge-Regression-With-R.html">Ridge Regression</a></li>
<li><a href="Lasso-Regression-With-R.html">Lasso Regression</a></li>
<li><a href="Beta-Regression-With-R.html">Beta Regression</a></li>
<li><a href="Dirichlet-Regression-With-R.html">Dirichlet Regression</a></li>
<li><a href="Loess-Regression-With-R.html">Loess Regression</a></li>
<li><a href="Isotonic-Regression-With-R.html">Isotonic Regression</a></li>

<li class="dropdown-header">Time Series</li>
<li><a href="Time-Series-Analysis-With-R.html">Time Series Analysis</a></li>
<li><a href="Time-Series-Forecasting-With-R.html">Time Series Forecasting </a></li>
<li><a href="Time-Series-Forecasting-With-R-part2.html">More Time Series Forecasting</a></li>

<li class="dropdown-header">High Performance Computing</li>
<li><a href="Parallel-Computing-With-R.html">Parallel computing</a></li>
<li><a href="Strategies-To-Improve-And-Speedup-R-Code.html">Strategies to Speedup R code</a></li>

<li class="dropdown-header">Useful Techniques</li>
<li><a href="Multi-Dimensional-Scaling-With-R.html">Multi Dimensional Scaling</a></li>
<li><a href="Profiling.html">Optimization</a></li>

            </ul>
          </li>
        </ul>
        -->

        <h3 class="muted"><a href="/">r-statistics.co</a> <small>by Selva Prabhakaran</small></h3>
        <hr>
      </div>

      <div class="row">
        <div class="col-xs-12 col-sm-3" id="nav">
        <div class="well">
          <li>
            <ul class="list-unstyled">
              <li class="dropdown-header"></li>
<li class="dropdown-header">Tutorial</li>
<li><a href="R-Tutorial.html">R Tutorial</a></li>
<li class="dropdown-header">Foundations</li>
<li><a href="Linear-Regression.html">Linear Regression</a></li>
<li><a href="Assumptions-of-Linear-Regression.html">Assumptions of Linear Regression</a></li>
<li><a href="Statistical-Tests-in-R.html">Statistical Tests</a></li>
<li><a href="Variable-Selection-and-Importance-With-R.html">Feature Selection</a></li>
<li><a href="Model-Selection-in-R.html">Model Selection</a></li>
<li><a href="Logistic-Regression-With-R.html">Logistic Regression</a></li>
<li><a href="Environments.html">Advanced Linear Regression</a></li>

<li class="dropdown-header">Advanced Regression Models</li>
<li><a href="Robust-Regression-With-R.html">Robust Regression</a></li>
<li><a href="Probit-Regression-With-R.html">Probit Regression</a></li>
<li><a href="Multinomial-Regression-With-R.html">Multinomial Regression</a></li>
<li><a href="Ordinal-Logistic-Regression-With-R.html">Ordinal Logistic</a></li>
<li><a href="Poisson-And-Negative-Binomial-Regression-With-R.html">Poisson and Negative Binomial</a></li>
<li><a href="Ridge-Regression-With-R.html">Ridge Regression</a></li>
<li><a href="Lasso-Regression-With-R.html">Lasso Regression</a></li>
<li><a href="Beta-Regression-With-R.html">Beta Regression</a></li>
<li><a href="Dirichlet-Regression-With-R.html">Dirichlet Regression</a></li>
<li><a href="Loess-Regression-With-R.html">Loess Regression</a></li>
<li><a href="Isotonic-Regression-With-R.html">Isotonic Regression</a></li>

<li class="dropdown-header">Time Series</li>
<li><a href="Time-Series-Analysis-With-R.html">Time Series Analysis</a></li>
<li><a href="Time-Series-Forecasting-With-R.html">Time Series Forecasting </a></li>
<li><a href="Time-Series-Forecasting-With-R-part2.html">More Time Series Forecasting</a></li>

<li class="dropdown-header">High Performance Computing</li>
<li><a href="Parallel-Computing-With-R.html">Parallel computing</a></li>
<li><a href="Strategies-To-Improve-And-Speedup-R-Code.html">Strategies to Speedup R code</a></li>

<li class="dropdown-header">Useful Techniques</li>
<li><a href="Multi-Dimensional-Scaling-With-R.html">Multi Dimensional Scaling</a></li>
<li><a href="Profiling.html">Optimization</a></li>

            </ul>
          </li>
        </div>

        <div class="well">
          Want to get involved? <a href="mailto:rcodeprogramming@gmail.com">Let me know!</a>.
        </div>

        
        <h4>Contents</h4>
        
          <ul class="list-unstyled" id="toc"></ul>
        <!--
          <hr>
          <p><a href="/contribute.html">How to contribute</a></p>

          <p><a class="btn btn-primary" href="">Edit this page</a></p>
        -->  
        </div>

        <div id="content" class="col-xs-12 col-sm-8 pull-right">

          <blockquote>
<p>This is a follow-up to the introduction to <a href="Time-Series-Analysis-With-R">time series analysis</a>, but focused more on forecasting rather than analysis.</p>
</blockquote>
<h2>Simple Moving Average</h2>
<p>Simple moving average can be calculated using <code>ma()</code> from forecast</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sm &lt;-<span class="st"> </span><span class="kw">ma</span>(ts, <span class="dt">order=</span><span class="dv">12</span>) <span class="co"># 12 month moving average</span>
<span class="kw">lines</span>(sm, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>) <span class="co"># plot</span></code></pre></div>
<h2>Exponential Smoothing</h2>
<p>Simple, Double and Triple exponential smoothing can be performed using the HoltWinters() function. There are multiple implementations of the Holt Winters method – <code>hw()</code> {forecast} and <code>ets()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(forecast)

<span class="co"># Simple exponential smoothing: Level Only</span>
model &lt;-<span class="st"> </span><span class="kw">hw</span>(trainingData, <span class="dt">initial =</span> “optimal”, <span class="dt">h=</span>(forecastPeriodLen), <span class="dt">beta=</span><span class="ot">NULL</span>, <span class="dt">gamma=</span><span class="ot">NULL</span>) <span class="co"># h is the no. periods to forecast</span>

<span class="co"># Double Exponential smoothing: Level and Trend components</span>
model &lt;-<span class="st"> </span><span class="kw">hw</span>(trainingData, <span class="dt">initial =</span> “optimal”, <span class="dt">h=</span>(forecastPeriodLen), <span class="dt">gamma=</span><span class="ot">NULL</span>)

<span class="co"># Holt Winters: Level, Trend and Seasonality</span>
model &lt;-<span class="st"> </span><span class="kw">hw</span>(trainingData, <span class="dt">initial =</span> “optimal”, <span class="dt">h=</span>(forecastPeriodLen))
<span class="kw">plot</span>(model)
<span class="kw">accuracy</span>(model) <span class="co"># calculate accuracy measures</span></code></pre></div>
<h2>ARIMA</h2>
<p>The forecast package offers auto.arima() function to fit ARIMA models. It can also be manually fit using Arima(). A caveat with ARIMA models in R is that it does not have the functionality to fit long seasonality of more than 350 periods eg: 365 days for daily data or 24 hours for 15 sec data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Fit and forecast with auto.arima()</span>
autoArimaFit &lt;-<span class="st"> </span><span class="kw">auto.arima</span>(tsData)
<span class="kw">plot</span>(<span class="kw">forecast</span>(autoArimaFit, <span class="dt">h=</span><span class="dv">20</span>))

<span class="co"># Fit and forecast with Arima()</span>
arimaFit &lt;-<span class="st"> </span><span class="kw">Arima</span>(tsData,<span class="dt">order=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">0</span>))
<span class="kw">plot</span>(<span class="kw">forecast</span>(arimafit,<span class="dt">h=</span><span class="dv">20</span>))</code></pre></div>
<h2>How To Forecast ARIMA Models With Long Seasonality (Greater Than 350 Periods)?</h2>
<p>Upon plotting your Arima() forecast, you find a more or less flat forecast, it could be because of long seasonality. In such case, you can feed in the seasonality as an external regressor through the ‘xreg’ argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Fit &lt;-<span class="st"> </span><span class="kw">Arima</span>(tsData,<span class="dt">order=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">0</span>))  <span class="co"># fit Arima model</span>
Fit &lt;-<span class="st"> </span><span class="kw">auto.arima</span>(tsData, <span class="dt">seasonal=</span><span class="ot">FALSE</span>, <span class="dt">xreg=</span><span class="kw">fourier</span>(tsData,<span class="dv">4</span>))  <span class="co"># fit auto.arima model</span>
<span class="kw">plot</span>(<span class="kw">forecast</span>(Fit,<span class="dt">h=</span><span class="dv">20</span>))
pred &lt;-<span class="st"> </span><span class="kw">predict</span> (Fit, <span class="dt">newxreg=</span>newXregVar) <span class="co"># alternate way to forecast</span>
<span class="kw">plot</span>(<span class="kw">forecast</span>(fit, <span class="dt">h=</span>h, <span class="dt">xreg=</span><span class="kw">fourierf</span>(tsData,<span class="dv">4</span>,h))) <span class="co"># h is number of forecasts</span></code></pre></div>
<p>If you are using a numeric vector as an external regressor (xreg), make sure you change it to a data.frame() before feeding it as an xreg parameter to auto.arima(). You can also use multiple external regressors by binding them together as a data.frame().</p>
<h2>Some Useful External Regressors For Arima() and auto.arima()</h2>
<p>Any dataframe with as many rows as length of ts data can be used as ‘xreg’ argument. A couple of common ‘xreg’s that are used to model seasonal effects are below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Xreg1 &lt;-<span class="st"> </span><span class="kw">seasonaldummy</span>(tsData) <span class="co"># creates dummy binary variable for each period in a season.</span>
Xreg2 &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(~<span class="st"> </span><span class="kw">as.factor</span>(weekday) +<span class="st"> </span><span class="dv">0</span>)<span class="er">)</span> <span class="co"># weekday could be a monthday, hour-of-day, holiday indicator etc .. </span></code></pre></div>
<h2>How To Model Time Series With Complex Seasonality Pattern?</h2>
<p>Use the tbats() in forecast package. Time series with multiple-seasonality can be modelled with this method. Since this is a computationally intensive procedure, the in-built parallel processing facility may be leveraged.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tbatsFit &lt;-<span class="st"> </span><span class="kw">tbats</span>(tsData, <span class="dt">use.parallel=</span><span class="ot">TRUE</span>, <span class="dt">num.cores =</span> <span class="dv">2</span>) <span class="co"># fit tbats model</span>
<span class="kw">plot</span>(<span class="kw">forecast</span>(fit)) <span class="co"># plot</span>
components &lt;-<span class="st"> </span><span class="kw">tbats.components</span>(tbatsFit)
<span class="kw">plot</span>(components)</code></pre></div>
<h2>How To Find Confidence Intervals For My Forecasts?</h2>
<p>The predict() function has the facility. By providing the argument ‘prediction.interval=TRUE’ and ‘level = n’, the prediction intervals for a given confidence is calculated. Below is a general format of the code.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model &lt;-<span class="st"> </span><span class="kw">HoltWinters</span>(TS) <span class="kw">predict</span>(model, <span class="dv">50</span>, <span class="dt">prediction.interval =</span> <span class="ot">TRUE</span>, <span class="dt">level=</span> <span class="fl">0.99</span>)  <span class="co"># prediction.interval = TRUE</span></code></pre></div>
<h2>More Useful Functions Related To Time Series</h2>
<table>
<thead>
<tr class="header">
<th align="left">Functions</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">accuracy()</td>
<td align="left">accuracy measures of forecast</td>
</tr>
<tr class="even">
<td align="left">BoxCox, invBoxCox()</td>
<td align="left">Box-Cox transformation</td>
</tr>
<tr class="odd">
<td align="left">decompose()</td>
<td align="left">Decompose time series data into components</td>
</tr>
<tr class="even">
<td align="left">dm.test()</td>
<td align="left">Diebold-Mariano test compares the forecast accuracy</td>
</tr>
<tr class="odd">
<td align="left">monthdays()</td>
<td align="left">number of days in seasonal series</td>
</tr>
<tr class="even">
<td align="left">na.interp()</td>
<td align="left">interpolate missing values</td>
</tr>
<tr class="odd">
<td align="left">seasadj()</td>
<td align="left">Remove the seasonal components from a time series</td>
</tr>
<tr class="even">
<td align="left">seasonaldummy()</td>
<td align="left">create matrix of seasonal indicator variables</td>
</tr>
<tr class="odd">
<td align="left">seasonplot()</td>
<td align="left">Plot seasonal effects</td>
</tr>
</tbody>
</table>


        </div>
      </div>

      <div class="footer">
        <hr>
        <p>&copy; r-statistics.co. Powered by <a href="http://jekyllrb.com/">jekyll</a>,
          <a href="http://yihui.name/knitr/">knitr</a>, and
          <a href="http://johnmacfarlane.net/pandoc/">pandoc</a>. Source
          available on <a href="https://github.com/selva86/selva86.github.io/">github</a>.
          This work is licensed under the <a href="http://creativecommons.org/licenses/by-nc/3.0/">CC BY-NC 3.0 Creative Commons License.</a>
        </p>
      </div>

    </div> <!-- /container -->

  <script src="//code.jquery.com/jquery.js"></script>
  <script src="www/bootstrap.min.js"></script>
  <script src="www/toc.js"></script>
  <!-- MathJax Script -->
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
    });
  </script>
  <script type="text/javascript"
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  </body>
</html>